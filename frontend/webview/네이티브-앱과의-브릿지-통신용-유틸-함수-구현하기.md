# ë„¤ì´í‹°ë¸Œ ì•±ê³¼ì˜ ë¸Œë¦¿ì§€ í†µì‹ ìš© ìœ í‹¸ í•¨ìˆ˜ êµ¬í˜„í•˜ê¸°

<div style="margin-top: 16px">
  <Badge type="info" text="WebView" />
  <Badge type="info" text="ê°€ë…ì„±" />
</div>

## ğŸ”” ìƒí™©

ì›¹ë·° â†’ ë„¤ì´í‹°ë¸Œ ì•± â†’ ì›¹ë·°ë¡œ ì´ì–´ì§€ëŠ” ë¡œì§ì„ ì‘ì„±í•  ë•Œ, ìš”ì²­ ë¶€ë¶„ê³¼ ì‘ë‹µ ë¶€ë¶„ì„ ë”°ë¡œ ë¶„ë¦¬í•˜ì—¬ ì‘ì„±í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ë ‡ê²Œ í•˜ë©´ ì½”ë“œë¥¼ ì½ëŠ” ì‚¬ëŒì˜ ì‹œì ì´ ìœ„ì•„ë˜ë¡œ ì´ë™ë˜ë©´ì„œ ë§¥ë½ì„ ìœ ì§€í•˜ëŠ” ë° ì–´ë ¤ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ³ í•´ê²°ë²•

`Promise` ì™€ `CustomEvent` ë¥¼ í™œìš©í•˜ì—¬ ë„¤ì´í‹°ë¸Œ ì•±ê³¼ì˜ ë¸Œë¦¿ì§€ í†µì‹ ìš© ìœ í‹¸ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ê³ , ìœ í‹¸ í•¨ìˆ˜ì™€ `async/await`ì„ í•¨ê»˜ ì‚¬ìš©í•©ë‹ˆë‹¤.

## ğŸ“ ì½”ë“œ ì˜ˆì‹œ: ì „ìë¬¸ì„œ

ë„¤ì´í‹°ë¸Œ ì•±ì—ì„œë§Œ ë™ì‘ ê°€ëŠ¥í•œ â€œì „ìë¬¸ì„œâ€ ê¸°ëŠ¥ì´ ìˆìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì€ íë¦„ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.

1. ë„¤ì´í‹°ë¸Œ ì•±ì—ì„œ ì›¹ë·°ì™€ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
2. ì›¹ë·°ì—ì„œ ì¸í„°í˜ì´ìŠ¤ë¥¼ í˜¸ì¶œí•˜ë©´ ë„¤ì´í‹°ë¸Œ ì•±ì—ì„œ ì „ìë¬¸ì„œë¥¼ í™”ë©´ì— ë…¸ì¶œí•©ë‹ˆë‹¤.
3. ì‚¬ìš©ìê°€ ì „ìë¬¸ì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
4. ì‘ì„±ì´ ì™„ë£Œë˜ë©´, ì›¹ë·°ëŠ” ë„¤ì´í‹°ë¸Œ ì•±ìœ¼ë¡œë¶€í„° ì‘ì„±ëœ ê°’ì„ ë°›ì•„ ì¶”ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì§„í–‰í•©ë‹ˆë‹¤.

ì¦‰, ì›¹ë·° â†’ ë„¤ì´í‹°ë¸Œ ì•± â†’ ì›¹ë·° ìˆœìœ¼ë¡œ ë¡œì§ì´ ì´ì–´ì§€ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

```typescript
// 1. window.webInterfaceë¥¼ í˜¸ì¶œí•˜ì—¬ ë„¤ì´í‹°ë¸Œ ì•±ì—ê²Œ ì „ìë¬¸ì„œ ë…¸ì¶œì„ ìš”ì²­í•©ë‹ˆë‹¤
const handleBefore = () => {
	// ...
	window.webInterface.openElectronicDoc(JSON.stringify({ ... }));
}

// 2. ì „ìë¬¸ì„œ ì‘ì„±ì´ ì™„ë£Œë˜ë©´ ë„¤ì´í‹°ë¸Œ ì•±ì€ window.responseNativeì„ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µí•©ë‹ˆë‹¤
window.responseNative = (response) => {
	const { code } = JSON.parse(response);

	switch (code) {
		case "...":
			handleAfter();
			break;
		// ...
	}
}
```

## ğŸ‘ƒ ì½”ë“œ ëƒ„ìƒˆ ë§¡ì•„ë³´ê¸°

ì½”ë“œë¥¼ ì½ëŠ” ì‚¬ëŒì˜ ì‹œì ì´ ìœ„ì•„ë˜ë¡œ ì´ë™ë˜ë©´ì„œ ë§¥ë½ì„ ìœ ì§€í•˜ëŠ” ë° ì–´ë ¤ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, `window.responseNative` í•¨ìˆ˜ì˜ ì±…ì„ì´ ë¬´ì œí•œì ìœ¼ë¡œ ëŠ˜ì–´ë‚  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì „ìë¬¸ì„œê°€ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ì´ í•¨ìˆ˜ì—ì„œ ê´€ë¦¬í•˜ê²Œ ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì´ `window.responseNative` í•¨ìˆ˜ì— ì˜ì¡´í•˜ê²Œ ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì½”ë“œ ìˆ˜ì • ì‹œ ì˜í–¥ ë²”ìœ„ê°€ ê¸‰ê²©íˆ í™•ì¥ë˜ì–´ ìˆ˜ì •í•˜ê¸° í˜ë“  ì½”ë“œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

:::info
ì´ ì˜ˆì‹œì—ì„œëŠ” ê²°í•©ë„ ê´€ì ìœ¼ë¡œë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
:::

## âœï¸ ê°œì„ í•´ë³´ê¸°

ë¸Œë¦¿ì§€ í†µì‹ ì„ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šìœ¼ë©´ì„œ ìœ„ì—ì„œ ì•„ë˜ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì½”ë“œê°€ ì½íˆë„ë¡ ìœ í‹¸ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ë©´ ì•„ë˜ ì½”ë“œì²˜ëŸ¼ ë¡œì§ì„ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆì–´ ê°€ë…ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
const handleElectronicDoc = async () => {
  // ìš”ì²­ ì „ ë¡œì§

  const response = await asyncNative(() =>
    window.WebInterface.openElectronicDoc(JSON.stringify({ data }))
  );

  // ì‘ë‹µ ì´í›„ ë¡œì§
};
```

ì•„ë˜ ì½”ë“œì²˜ëŸ¼ `Promise` ì™€ `CustomEvent` ë¥¼ í™œìš©í•˜ì—¬ ìœ í‹¸ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
function asyncNative(callback) {
  const uuid = uuidv4();

  return new Promise((resolve) => {
    // 4. ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ë¥¼ ë“£ê³ , resolve ì²˜ë¦¬í•©ë‹ˆë‹¤
    const listener = (e) => {
      resolve({ response: e.detail, listener });
    };
    window.addEventListener(uuid, listener);

    // 2. ë„¤ì´í‹°ë¸Œ ì•±ìœ¼ë¡œë¶€í„° ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤
    window.responseNative = (response) => {
      // 3. ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤
      window.dispatchEvent(
        new CustomEvent(uuid, { detail: JSON.parse(response) })
      );
    };

    // 1. ë„¤ì´í‹°ë¸Œ ì•±ì—ê²Œ ìš”ì²­í•©ë‹ˆë‹¤
    callback();
  }).then(({ response, listener }) => {
    // 5. ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤
    delete window.responseNative;
    window.removeEventListener(uuid, listener);
    // 6. ì‘ë‹µ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤
    return response;
  });
}
```
